version: "3"
services:
  pelias_schema:
    image: ghcr.io/michaelkirk-pelias/schema:es8
    container_name: pelias_schema
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "./tools:/tools:ro"
    depends_on:
      - pelias_elasticsearch
  pelias_whosonfirst:
    image: ghcr.io/michaelkirk-pelias/whosonfirst:es8
    container_name: pelias_whosonfirst
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "./tools:/tools:ro"
      - "${DATA_DIR}:/data"
    depends_on:
      - pelias_elasticsearch
  pelias_polylines_prepare:
    image: ghcr.io/michaelkirk-pelias/polylines:es8
    container_name: pelias_polylines
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "${DATA_DIR}:/data"
  pelias_polylines_import:
    image: ghcr.io/michaelkirk-pelias/polylines:es8
    container_name: pelias_polylines
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "./tools:/tools:ro"
      - "${DATA_DIR}:/data"
    depends_on:
      - pelias_elasticsearch
  pelias_placeholder:
    image: pelias/placeholder:master
    container_name: pelias_placeholder
    environment: [ "PORT=4100" ]
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "${DATA_DIR}:/data"
  pelias_openstreetmap:
    image: ghcr.io/michaelkirk-pelias/openstreetmap:es8
    container_name: pelias_openstreetmap
    volumes:
      - "./pelias.json:/code/pelias.json"
      - "./tools:/tools:ro"
      - "${DATA_DIR}:/data"
    depends_on:
      - pelias_elasticsearch
  pelias_elasticsearch:
    image: ghcr.io/michaelkirk-pelias/elasticsearch:es8
    container_name: pelias_elasticsearch
    volumes:
      - "${DATA_DIR}/elasticsearch:/usr/share/elasticsearch/data"
    environment:
      - ES_JAVA_OPTS=-Xmx8g
      - discovery.type=single-node
      - xpack.security.enabled=false
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 65536
        hard: 65536
    cap_add: [ "IPC_LOCK" ]
    networks:
      default:
        aliases:
          - pelias-elasticsearch
volumes:
  pelias_data:
